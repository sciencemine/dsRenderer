{{!-- ce player should only care about the order things are playled not how they are played --}}
{{#if isTeaser}}
    {{asset-middleware asset=ce.playlist.teaser}}
{{else}}
    {{#with currentItem.primary as |primaryAsset|}}
        {{#each currentItem.backgrounds as |background key|}}
            {{asset-middleware asset=background.asset
                onassetdone=(action 'onassetdone' background.asset)
            }}
        {{/each}}
        {{!-- note that we only care if the primary asset id done --}}
        {{!-- Only care about options and callbacks on the primary asset --}}
        {{#asset-middleware
            asset=primaryAsset
            onassetdone=(action 'primaryAssetDone' primaryAsset)
            options=options
            callbacks=(hash
                onpause=(action onpause primaryAsset)
                onselect=(action onselect primaryAsset)
                onplay=(action onplay primaryAsset)
            )
        }}
            {{!-- if the concurrent asset is a track put it inside --}}
            {{#each currentItem.tracks as |track key|}}
                {{asset-middleware asset=track.asset
                    onassetdone=(action 'onassetdone' track.asset)
                }}
            {{/each}}
        {{/asset-middleware}}

        {{!-- otherwise put it outside --}}
        {{#each currentItem.overlays as |overlay key|}}
            {{asset-middleware asset=overlay.asset
                onassetdone=(action 'onassetdone' overlay.asset)
                options=(hash
                    playing=options.playing
                )
            }}
        {{/each}}
    {{/with}}
{{/if}}